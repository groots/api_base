"use strict";angular.module("tokenauthApp",["ui.router","ngAnimate"]),angular.module("tokenauthApp").config(["$urlRouterProvider","$stateProvider","$httpProvider",function(a,b,c){a.otherwise("/"),b.state("main",{url:"/",templateUrl:"/views/main.html"}).state("logout",{url:"/logout",controller:"LogoutCtrl"}).state("register",{url:"/register",templateUrl:"/views/register.html",controller:"RegisterCtrl"}).state("login",{url:"/login",templateUrl:"/views/login.html",controller:"LoginCtrl"}).state("wagers",{url:"/wagers",templateUrl:"/views/wagers.html",controller:"WagersCtrl"}).state("pricing",{url:"/pricing",templateUrl:"/views/pricing.html"}).state("contact",{url:"/contact",templateUrl:"/views/contact.html"}),c.interceptors.push("authInterceptor")}]).constant("API_URL","http://localhost:3000/").run(["$window",function(a){var b=a.location.search.substring(1);if(b&&a.opener&&a.opener.location.origin===a.location.origin){var c=b.split("="),d=decodeURIComponent(c[1]);a.opener.postMessage(d,a.location.origin)}}]),angular.module("tokenauthApp").directive("validateEqualsTo",function(){return{require:"ngModel",link:function(a,b,c,d){function e(b){var e=b===a.$eval(c.validateEqualsTo);return d.$setValidity("equal",e),e?b:void 0}d.$parsers.push(e),d.$formatters.push(e),a.$watch(c.validateEqualsTo,function(){d.$setViewValue(d.$viewValue)})}}}),angular.module("tokenauthApp").directive("userInfoCard",function(){return{template:"George is coming",restrict:"E"}}),angular.module("tokenauthApp").controller("RegisterCtrl",["$scope","alert","auth",function(a,b,c){a.submit=function(){c.register(a.email,a.password).success(function(a){b("success","Account Created!","Welcome, "+a.user.email+"!")}).error(function(a){b("warning","Opps!","We might have a mistake - "+a)})}}]),angular.module("tokenauthApp").service("alert",["$rootScope","$timeout",function(a,b){var c;return function(d,e,f,g){a.alert={hasBeenShown:!0,show:!0,type:d,title:e,message:f},b.cancel(c),c=b(function(){a.alert.show=!1},g||2e3)}}]),angular.module("tokenauthApp").factory("authToken",["$window",function(a){var b,c=a.localStorage,d="userToken",e={setToken:function(a){b=a,c.setItem(d,a)},getToken:function(){return b||(b=c.getItem(d)),b},isAuthenticated:function(){return!!e.getToken()},removeToken:function(){b=null,c.removeItem(d)}};return e}]),angular.module("tokenauthApp").controller("HeaderCtrl",["$scope","authToken",function(a,b){a.isAuthenticated=b.isAuthenticated}]),angular.module("tokenauthApp").controller("LogoutCtrl",["authToken","$state",function(a,b){a.removeToken(),b.go("main")}]),angular.module("tokenauthApp").controller("WagersCtrl",["$scope","$http","API_URL","alert",function(a,b,c,d){b.get(c+"wagers").success(function(b){a.wagers=b}).error(function(a){d("warning","Does not exist",a.message)})}]),angular.module("tokenauthApp").controller("LoginCtrl",["$scope","alert","auth",function(a,b,c){a.submit=function(){c.login(a.email,a.password).success(function(a){b("success","Login Sucessful!","Welcome, "+a.user.email+"!")}).error(function(a){console.log(a),b("warning","Opps!","We might have a mistake - "+a)})},a.google=function(){c.googleAuth()}}]),angular.module("tokenauthApp").factory("authInterceptor",["authToken",function(a){return{request:function(b){var c=a.getToken();return c&&(b.headers.Authorization="Bearer "+c),b},response:function(a){return a}}}]),angular.module("tokenauthApp").service("auth",["$http","API_URL","authToken","$state","$window",function(a,b,c,d,e){function f(a){c.setToken(a.token),d.go("main")}this.login=function(c,d){return a.post(b+"login",{email:c,password:d}).success(f)},this.register=function(c,d){return a.post(b+"register",{email:c,password:d}).success(f)};var g=[];g.push("response_type=code","client_id=285471473072-rolf3qaodbpjp3fhhkq56sqhbdddcmsh.apps.googleusercontent.com","redirect_uri="+window.location.origin,"scope=profile email"),this.googleAuth=function(){var c="https://accounts.google.com/o/oauth2/auth?"+g.join("&"),d="width=500, height=500, left="+(e.outerWidth-500)/2+", top="+(e.outerHeight-500)/2.5,f=e.open(c,"",d);e.focus(),e.addEventListener("message",function(c){if(c.origin===e.location.origin){console.log(c.data);var d=c.data;f.close(),a.post(b+"auth/google",{code:d})}})}}]),angular.module("tokenauthApp").run(["$templateCache",function(a){a.put("views/alert.html","<div class=\"alert alert-{{alert.type}} animated main-alert\" ng-class=\"{'flipInY': alert.show,'flipOutY': !alert.show, 'alert-hidden': !alert.hasBeenShown}\"> <strong>{{alert.title}}</strong> {{alert.message}} </div>"),a.put("views/contact.html",'<form ng-submit="submit()" name="contact" class="form-signin"> <h1 class="form-signin-heading text-muted">Contact Now.</h1> <input type="text" name="name" ng-model="name" class="form-control" placeholder="Name" required> <input type="email" name="email" ng-model="email" class="form-control" placeholder="Email Address" required> <textarea ng-model="password_confirm" name="contact_message" class="form-control" placeholder="Message" required></textarea> <button class="btn btn-lg btn-primary btn-block" type="submit"> Submit </button> </form>'),a.put("views/header.html",'<div ng-controller="HeaderCtrl" class="header"> <div class="navbar navbar-default" role="navigation"> <div class="container"> <div class="navbar-header"> <a class="navbar-brand" href="#/">Make A Friendly Wager</a> </div> <div class="collapse navbar-collapse" id="js-navbar-collapse"> <ul class="nav navbar-nav navbar-right"> <li ui-sref-active="active"><a ui-sref="main">Home</a></li> <li ng-show="isAuthenticated()" ui-sref-active="active"><a ui-sref="wagers">Wagers</a></li> <li ng-hide="isAuthenticated()" ui-sref-active="active"> <a ui-sref="pricing">Pricing</a> </li> <li ng-hide="isAuthenticated()" ui-sref-active="active"> <a ui-sref="login">Login</a> </li> <li ng-show="isAuthenticated()" ui-sref-active="active"> <a ui-sref="logout">Logout</a> </li> <li ng-hide="isAuthenticated()" ui-sref-active="active"> <a ui-sref="contact">Contact</a> </li> </ul> </div> </div> </div> </div>'),a.put("views/login.html",'<form ng-submit="submit()" name="login" class="form-signin"> <h1 class="form-signin-heading text-muted">Login Now.</h1> <input type="email" name="email" ng-model="email" class="form-control" placeholder="Email address" required> <input type="password" ng-model="password" name="password" class="form-control" placeholder="Password" required> <button ng-disabled="register.$invalid" class="btn btn-lg btn-primary btn-block" type="submit"> Login </button> <br> <a class="text-muted pull-right" ui-sref="register">Create Account</a> <button ng-click="google()" class="btn btn-lg btn-default btn-block" type="button"> Google </button> </form>'),a.put("views/main.html",'<div class="jumbotron"> <user-info-card></user-info-card> <h1>Authing</h1> <p class="lead"> Practice Authentication today! </p> </div>'),a.put("views/pricing.html",'<div class="container"> <div class="row"> <h1 class="col-sm-12">Pricing</h1> <div class="col-sm-3"> <h2 class="package_title">100 Bets</h2> <div class="package_description">8 Users</div> <div class="package_price">$5</div> <form action="" method="POST"> <script src="https://checkout.stripe.com/checkout.js" class="stripe-button" data-key="pk_test_erBk71RuOqU7HAqdmFbSOllj" data-amount="2000" data-name="Demo Site" data-description="2 widgets ($20.00)" data-image="/128x128.png" data-locale="auto"></script> </form> </div> <div class="col-sm-3"> <h2 class="package_title">500 Bets</h2> <div class="package_description">8 Users</div> <div class="package_price">$10</div> <form action="" method="POST"> <script src="https://checkout.stripe.com/checkout.js" class="stripe-button" data-key="pk_test_erBk71RuOqU7HAqdmFbSOllj" data-amount="2000" data-name="Demo Site" data-description="2 widgets ($20.00)" data-image="/128x128.png" data-locale="auto"></script> </form> </div> <div class="col-sm-3"> <h2 class="package_title">1000 Bets</h2> <div class="package_description">8 Users</div> <div class="package_price">$15</div> <form action="" method="POST"> <script src="https://checkout.stripe.com/checkout.js" class="stripe-button" data-key="pk_test_erBk71RuOqU7HAqdmFbSOllj" data-amount="2000" data-name="Demo Site" data-description="2 widgets ($20.00)" data-image="/128x128.png" data-locale="auto"></script> </form> </div> </div> </div>'),a.put("views/register.html",'<form ng-submit="submit()" name="register" class="form-signin"> <h1 class="form-signin-heading text-muted">Register Now.</h1> <input type="email" name="email" ng-model="email" class="form-control" placeholder="Email address" required> <input type="password" ng-model="password" name="password" class="form-control" placeholder="Password" required> <input type="password" ng-model="password_confirm" name="password_confirm" class="form-control" placeholder="Rinse and Repeat" validate-equals-to="password"> <p class="help-block" ng-show="register.password_confirm.$dirty && register.password_confirm.$invalid">Please Match The Passwords. </p> <button class="btn btn-lg btn-primary btn-block" type="submit"> Submit </button> </form>'),a.put("views/wagers.html",'<div class="container"> <h1>My Wagers</h1> </div> <div ng-repeat="wager in wagers">{{wagers}}</div>')}]);